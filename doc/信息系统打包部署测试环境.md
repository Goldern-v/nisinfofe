---
title: 信息系统打包部署测试环境
---
>信息系统打包部署测试环境

### 1.找后端文件上传端口与路径
````js
1.例如端口：9872   //9872为启动端口 http://192.168.1.54:9872/crNursing/login
2.例如文件上传地址："/crdata/webProject/nursingInfoSystem/[hospital_id]/"   //文件上传地址
````

### 2.配置环境变量  

1.在 `config-new/env.all.js` 中,创建环境变量配置  

````js
  //.env-cmdrc
  // [hospital_id] 对应医院的环境变量
  // 添加一个新的医院环境
  [hospital_id]: {
    HOSPITAL_ID: [hospital_id],
    HOSPITAL_NAME: '"佛山市顺德区龙江医院"',//医院名称
    HOSPITAL_NAME_SPACE: '"广 东 医 科 大 学 附 属 第 三 医 院  （佛山市顺德区龙江医院）"',//医院全称
    COMPANY_NAME: '"百辰源(广州)科技有限公司"',
    ABOUT_INFO: '"关于百辰源"',
    title: '"智慧护理信息系统"'
  }
````

### 3.配置 `package.json` 里面的命令  

````json
  // package.json
  // package.json
  {
    "scripts": {
      "dev:[hospital_id]": "npm run dev --[hospital_id]", // 本地运行命令
      "buildNew:[hospital_id]": "npm run buildNew: [hospital_id]", // 打包命令包含静态文件上传
    }
  }
````

### 4.在 `build-new/publish.js` 配置公司测试环境部署的文件路径(没有则忽略)  

````js
  // publish.js
  let hospitalList = {//新增医院简称key:value,key为config/env.all.js配置的HOSPITAL_NAME，value为服务器路径，找后端拿
    东莞市厚街医院: "dongguanhoujie",
    威县人民医院: "weixian",
    德州市陵城区人民医院: "lingcheng",
    花都武警医院: "huaduwujing",
    广州市花都区人民医院: "huadu",
    武警广东总队医院: "wujing",
    江门市妇幼保健院: "fuyou",
    聊城市第二人民医院: "liaocheng",
    贵州省人民医院: "guizhourenyi",
    中山大学附属第七医院: "zhongshanqiyuan",
    东莞市横沥医院: "dongguanhengli",
    南方医科大学中西医结合医院: "nanfangzhongxiyi",
    东莞市谢岗医院: "xiegang",
    山南市人民医院: "shannanrenyi",
    阳春中医院: "yczy",
    佛山市第一人民医院: "foshanshiyi",
    武汉亚心医院:"wuhanyaxin",
    武汉市肺科医院:"wuhanfeike",
    佛山市顺德区龙江医院:"shundelongjiang",
    南方医科大学顺德医院附属杏坛医院: "fsxt"
  };
  let hospitalEN = "dongguanhoujie";//默认厚街
  if (hospitalList[hospitalName]) {
    hospitalEN = hospitalList[hospitalName];
    folderSrc = `/crdata/webProject/nursingInfoSystem/${hospitalEN}/`;
  }
  if (["/", "", "\\", undefined, null].indexOf(folderSrc) > -1) {
    folderSrc = `/crdata/webProject/nursingInfoSystem/${hospitalEN}/`;
  }
````

### 5.执行 `package.json` 命令并访问
````js
1.npm run buildNew:[hospital_id]
2.上传成功访问 http://192.168.1.54:[测试环境端口号]/crNursing/login/
````


### 6.代替步骤1(找后端文件上传端口与路径)——配置服务器项目路径与端口（不了解nginx、linux谨慎、谨慎、谨慎操作）
1.  找运维或者后端拿访问服务器账号密码
2.  进入服务器判断配置端口是否被占用,例如：netstat  -anp  | grep  [测试环境端口号]
3.  服务器新建项目存放目录
[测试环境端口号]，[hospital_name]改为对应的端口与简称
````js
/crdata/webProject/nursingInfoSystem/[hospital_name]//信息系统，也可自定义目录
/crdata/crNursing-9009/nursing/form/[hospital_name]-form-sys/dist//表单系统 ，也可自定义目录
alias /crdata/webProject/manage-[hospital_name]; //管理系统 ，也可自定义目录
````
4.  访问打开/etc/nginx/conf.d/crNursing2.conf
#添加配置 [测试环境端口号]，[hospital_name]改为对应的端口与简称（信息、管理、表单系统通用一套nginx配置）
````js
# 江门妇幼
server{
        listen [测试环境端口号];
        server_name  server_namejmfy;
        client_max_body_size 1000M;
        location ~ ^/crNursing/(admin|api|message) {
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_pass http://127.0.0.1:9009;
        }
        #[hospital_name]-form-sys [hospital_name]为医院简称
        location ~ ^/crNursing/(resource|webpage|webjars|restapi|[hospital_name]-form-sys|white|nurseList|crNursing-admin|webservices) {
                #expires 12h;
                proxy_pass http://127.0.0.1:9009;
        }
        
        location /crNursing/sheet-print {
    		rewrite ^/crNursing/(.*)$ /crNursing/sheet-print.html break;
		    proxy_pass http://127.0.0.1:9009;
	      }

        location /crNursing/formUrl {
          #表单文件地址 [hospital_name]为医院简称
          alias /crdata/crNursing-9009/nursing/form/[hospital_name]-form-sys/dist;
        }	

        location /crNursing/whit {
          #白板系统文件路径
	       	root /;
        	rewrite ^/crNursing/(.*)$ /crdata/webProject/nursingWhiteBoard/whiteboard.html break;
        }

        location /crNursing/index2 {
                rewrite ^/crNursing/(.*)$ /crNursing/index2.html break;
                proxy_pass http://127.0.0.1:9009;
        }

        location /crNursing/missionPublicAccount {
          alias /crdata/webProject/missionPublicAccount;
        }
        
        location /crNursing/manage {
          #管理系统文件路径[hospital_name]为医院简称
          alias /crdata/webProject/manage-[hospital_name];
        }

        #不良事件管理系统文件路径[hospital_name]为医院简称
        location /crNursing/badevent/manage {
          alias /crdata/webProject/badeventManage;
        }
       #不良事件系统文件路径[hospital_name]为医院简称
        location /crNursing/badevents {
          alias /crdata/webProject/badevent;
          try_files $uri $uri/ /crNursing/badevents/index.html;
        }

        #信息系统 [hospital_name]为医院简称
        location /crNursing/ {
	          	root /;
              rewrite ^/crNursing/(.*)$ /crdata/webProject/nursingInfoSystem/[hospital_name]/index.html break;
        }

        #信息系统静态文件 [hospital_name]为医院简称
        location /crNursing/static/ {
                alias /crdata/webProject/nursingInfoSystem/[hospital_name]/static/;
        }
	
        location /crNursing/asset/ {
                alias /crdata/crNursing-9009/nursing/;
        }

        location /hcres/ {
                proxy_pass http://119.145.71.86:9801;
        }

}
````
5.  保存nginx 检查语法是否正常执行:nginx -t
6.  重启nginx 执行：nginx -s reload
7.  测试访问
 管理系统 http://192.168.1.54:[测试环境端口号]/crNursing/manage/#/
 信息系统系统 http://192.168.1.54:[测试环境端口号]/crNursing/login

